<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>iStore - –ì–ª–∞–≤–Ω–∞—è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f5f5f7; margin: 0; }
        
        /* –®–∞–ø–∫–∞ */
        header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); position: sticky; top: 0; padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 20px rgba(0,0,0,0.05); z-index: 100; }
        .logo { font-weight: bold; font-size: 24px; color: #1d1d1f; text-decoration: none; }
        
        /* –ü–æ–∏—Å–∫ */
        .search-box { flex-grow: 1; margin: 0 20px; max-width: 400px; }
        .search-box input { width: 100%; padding: 10px 15px; border-radius: 20px; border: 1px solid #d2d2d7; background: #e8e8ed; font-size: 16px; outline: none; transition: 0.2s; }
        .search-box input:focus { background: white; border-color: #0071e3; }

        .nav-icons a { margin-left: 15px; text-decoration: none; font-size: 20px; }

        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto; }
        
        .card { background: white; border-radius: 20px; padding: 30px; text-align: center; transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; display: flex; flex-direction: column; justify-content: space-between; height: 350px; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .card img { max-width: 100%; max-height: 180px; object-fit: contain; margin-bottom: 20px; }
        .card h3 { margin: 10px 0; color: #1d1d1f; font-size: 20px; }
        .price { font-size: 18px; color: #1d1d1f; margin-bottom: 15px; }
        .btn { background: #0071e3; color: white; padding: 10px 20px; border-radius: 20px; text-decoration: none; display: inline-block; font-weight: 500; border: none; cursor: pointer; }
        .btn:hover { background: #005bb5; }
        .specs { font-size: 12px; color: #86868b; margin-bottom: 10px; }

    </style>
</head>
<body>

    <header>
        <a href="/" class="logo">Ô£ø iStore</a>
        
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: iPhone)..." oninput="doSearch()">
        </div>

        <div class="nav-icons">
            <a href="/cart.html">üõí</a>
            <a href="/profile.html">üë§</a>
        </div>
    </header>

    <div class="grid" id="products-container">
        </div>

<script>
    let allProducts = []; // –¢—É—Ç —Ö—Ä–∞–Ω–∏–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã

    async function loadProducts() {
        const container = document.getElementById('products-container');
        container.innerHTML = "<h2 style='text-align:center; width:100%'>–ó–∞–≥—Ä—É–∑–∫–∞...</h2>";
        
        try {
            const response = await fetch('https://istore-i9oo.onrender.com/api/products');
            allProducts = await response.json();
            renderProducts(allProducts); // –†–∏—Å—É–µ–º —Ç–æ–≤–∞—Ä—ã
        } catch (e) {
            container.innerHTML = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ :(";
        }
    }

    function renderProducts(products) {
        const container = document.getElementById('products-container');
        
        if (products.length === 0) {
            container.innerHTML = "<p style='text-align:center; width:100%'>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üò¢</p>";
            return;
        }

        container.innerHTML = products.map(product => `
            <div class="card">
                <img src="${product.img}" alt="${product.name}">
                <div>
                    <h3>${product.name}</h3>
                    <div class="specs">${product.specs || ''}</div>
                    <div class="price">$${product.price}</div>
                    <button class="btn" onclick="addToCart(${product.id}, '${product.name}', ${product.price})">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        `).join('');
    }

    // üîç –§–£–ù–ö–¶–ò–Ø –ñ–ò–í–û–ì–û –ü–û–ò–°–ö–ê
    function doSearch() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        
        // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ø–∏—Å–æ–∫
        const filtered = allProducts.filter(p => 
            p.name.toLowerCase().includes(query) || 
            (p.specs && p.specs.toLowerCase().includes(query))
        );
        
        renderProducts(filtered);
    }

    function addToCart(id, name, price) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.push({ id, name, price });
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // –ö—Ä–∞—Å–∏–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
        const btn = event.target;
        const oldText = btn.innerText;
        btn.innerText = "–í –∫–æ—Ä–∑–∏–Ω–µ! ‚úÖ";
        btn.style.background = "#34c759";
        setTimeout(() => {
            btn.innerText = oldText;
            btn.style.background = "#0071e3";
        }, 1000);
    }

    loadProducts();
</script>

</body>
</html>